#define LOG_TAG "LCM"

#ifndef BUILD_LK
#include <linux/string.h>
#include <linux/kernel.h>
#endif

#include "lcm_drv.h"


#ifdef BUILD_LK
#include <platform/upmu_common.h>
#include <platform/mt_gpio.h>
#include <platform/mt_i2c.h>
#include <platform/mt_pmic.h>
#include <string.h>
#elif defined(BUILD_UBOOT)
#include <asm/arch/mt_gpio.h>
#else
#include <mach/mt_pm_ldo.h>
#include <mach/mt_gpio.h>
#endif

/*prize-add-for round corner-houjian-20180918-start*/
#ifdef MTK_ROUND_CORNER_SUPPORT
#include "data_rgba4444_roundedpattern.h"
#endif
/*prize-add-for round corner-houjian-20180918-end*/

#ifdef BUILD_LK
#define LCM_LOGI(string, args...)  dprintf(0, "[LK/"LOG_TAG"]"string, ##args)
#define LCM_LOGD(string, args...)  dprintf(1, "[LK/"LOG_TAG"]"string, ##args)
#else
#define LCM_LOGI(fmt, args...)  pr_notice("[KERNEL/"LOG_TAG"]"fmt, ##args)
#define LCM_LOGD(fmt, args...)  pr_debug("[KERNEL/"LOG_TAG"]"fmt, ##args)
#endif

#define I2C_I2C_LCD_BIAS_CHANNEL 0
static LCM_UTIL_FUNCS lcm_util;

#define SET_RESET_PIN(v)			(lcm_util.set_reset_pin((v)))
#define MDELAY(n)					(lcm_util.mdelay(n))

/* --------------------------------------------------------------------------- */
/* Local Functions */
/* --------------------------------------------------------------------------- */
#define dsi_set_cmdq_V2(cmd, count, ppara, force_update) \
	lcm_util.dsi_set_cmdq_V2(cmd, count, ppara, force_update)
#define dsi_set_cmdq(pdata, queue_size, force_update) \
	lcm_util.dsi_set_cmdq(pdata, queue_size, force_update)
#define wrtie_cmd(cmd) \
	lcm_util.dsi_write_cmd(cmd)
#define write_regs(addr, pdata, byte_nums) \
	lcm_util.dsi_write_regs(addr, pdata, byte_nums)
#define read_reg(cmd) \
	lcm_util.dsi_dcs_read_lcm_reg(cmd)
#define read_reg_v2(cmd, buffer, buffer_size) \
	lcm_util.dsi_dcs_read_lcm_reg_v2(cmd, buffer, buffer_size)

static const unsigned char LCD_MODULE_ID = 0x01;
/* --------------------------------------------------------------------------- */
/* Local Constants */
/* --------------------------------------------------------------------------- */
#define LCM_DSI_CMD_MODE	0
#define FRAME_WIDTH  										1080
#define FRAME_HEIGHT 										2340

#define GPIO_TP_RST (GPIO158 | 0x80000000)
//prize-penggy modify LCD size-20190328-start
#define LCM_PHYSICAL_WIDTH                  				(67070)
#define LCM_PHYSICAL_HEIGHT                  				(145310)
//prize-penggy modify LCD size-20190328-end

#define REGFLAG_DELAY             							 0xFFFA
#define REGFLAG_UDELAY             							 0xFFFB
#define REGFLAG_PORT_SWAP									 0xFFFC
#define REGFLAG_END_OF_TABLE      							 0xFFFD   // END OF REGISTERS MARKER

#ifndef TRUE
#define TRUE 1
#endif

#ifndef FALSE
#define FALSE 0
#endif


struct LCM_setting_table {
	unsigned int cmd;
	unsigned char count;
	unsigned char para_list[190];
};

static struct LCM_setting_table lcm_initialization_setting[] = {

	{0xB0,1,{0x00}},
	{0xB6,5,{0x30 ,0x6b ,0x00 ,0x82 ,0xe3}},
	{0xB7,4,{0x51 ,0x00 ,0x00 ,0x00}},
	{0xB8,7,{0x57 ,0x3d ,0x19 ,0xbe ,0x1e ,0x0a ,0x0a}},
	{0xB9,7,{0x6f ,0x3d ,0x28 ,0xbe ,0x3c ,0x14 ,0x0a}},
	{0xBA,7,{0xb5 ,0x33 ,0x41 ,0xbe ,0x64 ,0x23 ,0x0a}},
	{0xBB,11,{0x44 ,0x26 ,0xc3 ,0x1f ,0x19 ,0x06 ,0x03 ,0xc0 ,0x00 ,0x00 ,0x10}},
	{0xBC,11,{0x32 ,0x4c ,0xc3 ,0x52 ,0x32 ,0x1f ,0x03 ,0xf2 ,0x00 ,0x00 ,0x13}},
	{0xBD,11,{0x24 ,0x68 ,0xc3 ,0xaa ,0x3f ,0x32 ,0x03 ,0xff ,0x00 ,0x00 ,0x25}},
	{0xBE,12,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC0,22,{0x00 ,0xcd ,0x01 ,0x2c ,0x0a ,0x09 ,0x24 ,0x00 ,0x0a ,0x00 
			 ,0x00 ,0x08 ,0x60 ,0x70 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00}},
	{0xC1,45,{0x30 ,0x00 ,0x00 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x22 ,0x00 
			 ,0x05 ,0x20 ,0x00 ,0x80 ,0xfa ,0x40 ,0x00 ,0x80 ,0x0f ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x01 ,0x2c ,0x08 ,0x08}},
	{0xC2,141,{0x00 ,0x00 ,0xcc ,0x02 ,0x02 ,0x00 ,0x07 ,0x05 ,0x44 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x40 ,0xc1 
			 ,0x04 ,0x04 ,0x01 ,0x01 ,0x01 ,0x00 ,0x09 ,0x37 ,0x00 ,0x00 
			 ,0x01 ,0x08 ,0x00 ,0x00 ,0x00 ,0x44 ,0x11 ,0x00 ,0x09 ,0x37 
			 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x11 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00}},
	{0xC3,108,{0x00 ,0x00 ,0xc3 ,0x01 ,0x95 ,0xa9 ,0x6a ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0xcc ,0x01 ,0x93 ,0x99 ,0x5a ,0x04 ,0x02 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0xaa ,0xaa ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x01 ,0x00 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xc0 
			 ,0x00 ,0x01 ,0x00 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xc0 
			 ,0x00 ,0x01 ,0x00 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xc0 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC4,97,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x54 ,0x4c 
			 ,0x51 ,0x4d ,0x4d ,0x61 ,0x5f ,0x5d ,0x0f ,0x11 ,0x44 ,0x4f 
			 ,0x4f ,0xbe ,0xbf ,0x03 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x54 ,0x4c ,0x51 ,0x4d ,0x4d ,0x61 ,0x5f ,0x5d 
			 ,0x0e ,0x10 ,0x44 ,0x4f ,0x4f ,0xbe ,0xbf ,0x02 ,0xff ,0xff 
			 ,0xff ,0xff ,0xff ,0xff ,0x00 ,0xfe ,0xe7 ,0x00 ,0xfe ,0xe7 
			 ,0x00 ,0x02 ,0x18 ,0x00 ,0x02 ,0x18 ,0x00 ,0xe0 ,0x00 ,0x00 
			 ,0xe0 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x04 ,0x04 
			 ,0x00 ,0x00 ,0x04 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x50 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC5,5,{0x08 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC6,62,{0x00 ,0x1a ,0x08 ,0xfc ,0xff ,0xff ,0xff ,0x00 ,0x00 ,0x13 
			 ,0x01 ,0xff ,0x00 ,0x01 ,0x0b ,0x3a ,0x3c ,0x36 ,0x00 ,0x00 
			 ,0x00 ,0x01 ,0x05 ,0x09 ,0x28 ,0x28 ,0x01 ,0x0b ,0x3a ,0x3c 
			 ,0x36 ,0x01 ,0x0b ,0x00 ,0x00 ,0x00 ,0x1e ,0x01 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x20 ,0x20 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x22 ,0x22 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x10 ,0x00}},
	{0xC7,76,{0x00 ,0xF6 ,0x01 ,0x55 ,0x01 ,0x8A ,0x01 ,0x93 ,0x01 ,0x9E 
			 ,0x01 ,0x9E ,0x01 ,0xA1 ,0x01 ,0x9A ,0x01 ,0xB5 ,0x01 ,0x84 
			 ,0x01 ,0xD5 ,0x01 ,0x92 ,0x01 ,0xD3 ,0x01 ,0x8A ,0x01 ,0xEE 
			 ,0x01 ,0xE2 ,0x02 ,0x4B ,0x02 ,0x7C ,0x02 ,0xAE ,0x00 ,0xF6 
			 ,0x01 ,0x55 ,0x01 ,0x8A ,0x01 ,0x93 ,0x01 ,0x9E ,0x01 ,0x9E 
			 ,0x01 ,0xA1 ,0x01 ,0x9A ,0x01 ,0xB5 ,0x01 ,0x84 ,0x01 ,0xD5 
			 ,0x01 ,0x92 ,0x01 ,0xD3 ,0x01 ,0x8A ,0x01 ,0xEE ,0x01 ,0xE2 
			 ,0x02 ,0x4B ,0x02 ,0x7C ,0x02 ,0xAE}},
	{0xCB,14,{0xa0 ,0x80 ,0x70 ,0x00 ,0x20 ,0x00 ,0x00 ,0x2d ,0x41 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0xff}},
	{0xCE,33,{0x5d ,0x40 ,0x49 ,0x53 ,0x59 ,0x5e ,0x63 ,0x68 ,0x6e ,0x74 
			 ,0x7e ,0x8a ,0x98 ,0xa8 ,0xbb ,0xd0 ,0xe7 ,0xff ,0x04 ,0x00 
			 ,0x04 ,0x04 ,0x42 ,0x40 ,0x69 ,0x5a ,0x40 ,0x40 ,0x00 ,0x00 
			 ,0x04 ,0xfa ,0x00}},
	{0xCF,6,{0x00 ,0x00 ,0x80 ,0x46 ,0x61 ,0x00}},
	{0xD0,18,{0xdf ,0x0b ,0x83 ,0x66 ,0x09 ,0x90 ,0x00 ,0xcc ,0x0f ,0x05 
			 ,0xd7 ,0x4b ,0x52 ,0xfe ,0x09 ,0x09 ,0xcc ,0x00}},
	{0xD1,34,{0xd7 ,0xd7 ,0x1b ,0xe4 ,0x07 ,0x07 ,0xbb ,0x00 ,0x90 ,0x00 
			 ,0x90 ,0x05 ,0x11 ,0x7b ,0x07 ,0x11 ,0x7b ,0x78 ,0xd3 ,0xda 
			 ,0x06 ,0x96 ,0x1c ,0x93 ,0x22 ,0x22 ,0x22 ,0xb3 ,0xbb ,0x80 
			 ,0x00 ,0x99 ,0x99 ,0x00}},
	{0xD2,2,{0x00 ,0x00}},
	{0xD3,153,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff}},
	{0xD4,23,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00}},
	{0xE5,1,{0x03}},
	{0xD5,4,{0x00 ,0x32 ,0x00 ,0x33}},
	{0xD7,74,{0x21 ,0x10 ,0x52 ,0x52 ,0x00 ,0xcd ,0x00 ,0x0a ,0x00 ,0xb6 
			 ,0x04 ,0xfd ,0x01 ,0x00 ,0x03 ,0x00 ,0x05 ,0x05 ,0x00 ,0x03 
			 ,0x04 ,0x05 ,0x00 ,0x04 ,0x00 ,0x08 ,0x02 ,0x08 ,0x06 ,0x03 
			 ,0x08 ,0x04 ,0x08 ,0x08 ,0x0c ,0x0b ,0x0a ,0x0a ,0x0a ,0x07 
			 ,0x08 ,0x0a ,0x06 ,0x00 ,0x08 ,0x08 ,0x04 ,0x05 ,0x09 ,0x00 
			 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x02 ,0x04 ,0x04 
			 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x06 ,0x06 
			 ,0x05 ,0x05 ,0x05 ,0x00}},
	{0xD8,62,{0x00 ,0x12 ,0x41 ,0x00 ,0x41 ,0x00 ,0x82 ,0x00 ,0xa8 ,0xaa 
			 ,0x00 ,0x50 ,0x55 ,0x08 ,0xa2 ,0x2a ,0x0a ,0x45 ,0x15 ,0x0d 
			 ,0x8a ,0x8a ,0x0a ,0x15 ,0x45 ,0x0d ,0x2a ,0xa0 ,0x0a ,0x55 
			 ,0x50 ,0x0d ,0xaa ,0xa8 ,0x0a ,0x55 ,0x50 ,0x0d ,0x2a ,0xa2 
			 ,0x0a ,0x15 ,0x45 ,0x0d ,0x8a ,0x8a ,0x0a ,0x45 ,0x15 ,0x0d 
			 ,0xa2 ,0x2a ,0x0a ,0x51 ,0x55 ,0x0c ,0xa8 ,0xaa ,0x08 ,0x54 
			 ,0x55 ,0x01}},
	{0xD9,22,{0x42 ,0x97 ,0x26 ,0xed ,0x0f ,0x24 ,0x16 ,0x6c ,0x16 ,0x6c 
			 ,0x00 ,0x30 ,0x00 ,0x14 ,0x00 ,0x14 ,0x00 ,0x0c ,0x00 ,0x00 
			 ,0x01 ,0x00}},
	{0xDD,4,{0x30 ,0x06 ,0x23 ,0x65}},
	{0xDE,10,{0x00 ,0x00 ,0x00 ,0x0f ,0xff ,0x00 ,0x00 ,0x00 ,0x00 ,0x10}},
	{0xE6,10,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xE7,182,{0x11 ,0x00 ,0x89 ,0x10 ,0x80 ,0x09 ,0x24 ,0x04 ,0x38 ,0x00 
			 ,0x04 ,0x02 ,0x1c ,0x02 ,0x1c ,0x02 ,0x00 ,0x02 ,0x0e ,0x20 
			 ,0x00 ,0x56 ,0x00 ,0x07 ,0x0c ,0x20 ,0x00 ,0x19 ,0x6d ,0x18 
			 ,0x00 ,0x10 ,0xf0 ,0x03 ,0x0c ,0x20 ,0x00 ,0x06 ,0x0b ,0x0b 
			 ,0x33 ,0x0e ,0x1c ,0x2a ,0x38 ,0x46 ,0x54 ,0x62 ,0x69 ,0x70 
			 ,0x77 ,0x79 ,0x7b ,0x7d ,0x7e ,0x01 ,0x02 ,0x01 ,0x00 ,0x09 
			 ,0x40 ,0x09 ,0xbe ,0x19 ,0xfc ,0x19 ,0xfa ,0x19 ,0xf8 ,0x1a 
			 ,0x38 ,0x1a ,0x78 ,0x1a ,0xb6 ,0x2a ,0xf6 ,0x2b ,0x34 ,0x2b 
			 ,0x74 ,0x3b ,0x74 ,0x6b ,0xf4 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x11 ,0x00 ,0x89 ,0x10 ,0x80 ,0x09 ,0x24 ,0x04 ,0x38 
			 ,0x00 ,0x04 ,0x02 ,0x1c ,0x02 ,0x1c ,0x02 ,0x00 ,0x02 ,0x0e 
			 ,0x20 ,0x00 ,0x56 ,0x00 ,0x07 ,0x0c ,0x20 ,0x00 ,0x19 ,0x6d 
			 ,0x18 ,0x00 ,0x10 ,0xf0 ,0x03 ,0x0c ,0x20 ,0x00 ,0x06 ,0x0b 
			 ,0x0b ,0x33 ,0x0e ,0x1c ,0x2a ,0x38 ,0x46 ,0x54 ,0x62 ,0x69 
			 ,0x70 ,0x77 ,0x79 ,0x7b ,0x7d ,0x7e ,0x01 ,0x02 ,0x01 ,0x00 
			 ,0x09 ,0x40 ,0x09 ,0xbe ,0x19 ,0xfc ,0x19 ,0xfa ,0x19 ,0xf8 
			 ,0x1a ,0x38 ,0x1a ,0x78 ,0x1a ,0xb6 ,0x2a ,0xf6 ,0x2b ,0x34 
			 ,0x2b ,0x74 ,0x3b ,0x74 ,0x6b ,0xf4 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00}},
	{0xE8,4,{0x00 ,0x30 ,0x63 ,0x00}},
	{0xEA,30,{0x01 ,0x0e ,0x03 ,0xc0 ,0x0a ,0xa0 ,0xaa ,0x00 ,0x09 ,0x00 
			 ,0x02 ,0x94 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x04 ,0xc2 ,0x00 ,0x11 ,0x00 ,0xcd ,0x0c ,0xd0 ,0x86 ,0x00}},
	{0xEB,7,{0x02 ,0x40 ,0x0c ,0x00 ,0x01 ,0x00 ,0x01}},
	{0xEC,10,{0x04 ,0x90 ,0x08 ,0x10 ,0x52 ,0x0a ,0xa0 ,0xaa ,0x02 ,0x3a}},
	{0xED,32,{0x01 ,0x01 ,0x02 ,0x02 ,0x08 ,0x08 ,0x09 ,0x09 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x02 ,0x00 ,0x00 ,0x00 ,0x00 ,0x12 ,0x02 ,0x8c 
			 ,0x00 ,0x00 ,0x00 ,0x50 ,0x00 ,0x02 ,0x8c ,0x00 ,0x00 ,0xa0 
			 ,0x10 ,0x00}},
	{0xEE,96,{0xc3 ,0x17 ,0x00 ,0x00 ,0x00 ,0xfd ,0x01 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0xc2 ,0x5f ,0x7f ,0xf0 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0xc0 ,0x03 ,0x7f ,0xfc ,0x00 ,0x90 ,0x09 
			 ,0x09 ,0x09 ,0x49 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x40 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x01 ,0x00 ,0xc0 ,0x1f ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xEF,83,{0x00 ,0xe0 ,0x4a ,0x08 ,0x60 ,0x00 ,0x00 ,0x00 ,0x00 ,0x32 
			 ,0x32 ,0x32 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x10 ,0x00 ,0x10 ,0x00 ,0x00 
			 ,0x10 ,0x00 ,0x10 ,0x00 ,0x0a ,0x0a ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x43 ,0x00 ,0x03 ,0x40 ,0x00 ,0x00 ,0x05 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00
			 ,0x00 ,0x00 ,0x00}},
	{0xF9,5,{0x44 ,0x3f ,0x00 ,0x8d ,0xbf}},
	{0xB0,1,{0x03}},
	{0xB0,1,{0x00}},                               
	{0xD6,1,{0x00}},                                 
	{0x51,1,{0xFF}},                               
	{0x53,1,{0x0C}},                                
	{0x55,1,{0x00}},
	{0x11,1,{0x00}},
	{REGFLAG_DELAY,120,{}},


	{0x29,1,{0x00}},
	{REGFLAG_DELAY, 50, {}},

	{REGFLAG_END_OF_TABLE, 0x00, {}}    
              
};


#if 1
static struct LCM_setting_table lcm_suspend_setting[] = {
	{0x28, 1,{0x00} },
	{REGFLAG_DELAY, 120, {} },
	{0x10, 1,{0x00} },
	{REGFLAG_DELAY, 10, {} },
	{REGFLAG_END_OF_TABLE, 0x00, {}}  
};
#endif
static void push_table(struct LCM_setting_table *table, unsigned int count,
		       unsigned char force_update)
{
	unsigned int i;
	for (i = 0; i < count; i++) {
		unsigned cmd;

		cmd = table[i].cmd;

		switch (cmd) {

		case REGFLAG_DELAY:
			if (table[i].count <= 10)
				MDELAY(table[i].count);
			else
				MDELAY(table[i].count);
			break;

		case REGFLAG_END_OF_TABLE:
			break;

		default:
			dsi_set_cmdq_V2(cmd, table[i].count, table[i].para_list, force_update);
		}
	}
}


static void lcm_set_util_funcs(const LCM_UTIL_FUNCS *util)
{
	memcpy(&lcm_util, util, sizeof(LCM_UTIL_FUNCS));
}

static void lcm_get_params(LCM_PARAMS *params)
{
	memset(params, 0, sizeof(LCM_PARAMS));
	
	params->type = LCM_TYPE_DSI;
	
	params->width = FRAME_WIDTH;
	params->height = FRAME_HEIGHT;
	
	// enable tearing-free
	params->dbi.te_mode 				= LCM_DBI_TE_MODE_VSYNC_ONLY;
	params->dbi.te_edge_polarity		= LCM_POLARITY_RISING;
	#if (LCM_DSI_CMD_MODE)
	params->dsi.mode   = CMD_MODE;
	params->dsi.switch_mode = SYNC_PULSE_VDO_MODE;
	#else
	params->dsi.mode   = SYNC_PULSE_VDO_MODE;//SYNC_EVENT_VDO_MODE;//BURST_VDO_MODE;////
	#endif
		
	// DSI
	/* Command mode setting */
	//1 Three lane or Four lane
	params->dsi.LANE_NUM				= LCM_FOUR_LANE;
	//The following defined the fomat for data coming from LCD engine.
	params->dsi.data_format.color_order = LCM_COLOR_ORDER_RGB;
	params->dsi.data_format.trans_seq	= LCM_DSI_TRANS_SEQ_MSB_FIRST;
	params->dsi.data_format.padding 	= LCM_DSI_PADDING_ON_LSB;
	params->dsi.data_format.format		= LCM_DSI_FORMAT_RGB888;
		
		
	params->dsi.PS=LCM_PACKED_PS_24BIT_RGB888;
		
	#if (LCM_DSI_CMD_MODE)
	params->dsi.intermediat_buffer_num = 0;//because DSI/DPI HW design change, this parameters should be 0 when video mode in MT658X; or memory leakage
	params->dsi.word_count=FRAME_WIDTH*3;	//DSI CMD mode need set these two bellow params, different to 6577
	#else
	params->dsi.intermediat_buffer_num = 0; //because DSI/DPI HW design change, this parameters should be 0 when video mode in MT658X; or memory leakage
	#endif
	
	// Video mode setting
	params->dsi.packet_size=256;
	
	params->dsi.vertical_sync_active				=  4;
	params->dsi.vertical_backporch					= 60;//16 25 30 35 12 8
	params->dsi.vertical_frontporch					= 4;
	params->dsi.vertical_active_line				= FRAME_HEIGHT; 

	params->dsi.horizontal_sync_active = 8;
	params->dsi.horizontal_backporch = 10;//32
	params->dsi.horizontal_frontporch = 17;//78
	params->dsi.horizontal_active_pixel = FRAME_WIDTH;
	/* params->dsi.ssc_disable                                                       = 1; */

	params->dsi.PLL_CLOCK = 480;//520;//244;
	params->dsi.ssc_disable = 0;
	params->dsi.ssc_range = 1;
	params->dsi.cont_clock = 0;
	params->dsi.clk_lp_per_line_enable = 0;
	//prize-penggy modify LCD size-20190328-start
	params->physical_width = LCM_PHYSICAL_WIDTH/1000;
	params->physical_height = LCM_PHYSICAL_HEIGHT/1000;

	
}



static unsigned int lcm_compare_id(void)
{
   return 1; 
}

static void lcm_init(void)
{
	int ret = 0;

	SET_RESET_PIN(0);

#ifndef MACH_FPGA
	/*config rt5081 register 0xB2[7:6]=0x3, that is set db_delay=4ms.*/
	ret = PMU_REG_MASK(0xB2, (0x3 << 6), (0x3 << 6));

	/* set AVDD 5.4v, (4v+28*0.05v) */
	/*ret = RT5081_write_byte(0xB3, (1 << 6) | 28);*/
	ret = PMU_REG_MASK(0xB3, 28, (0x3F << 0));
	if (ret < 0)
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write error----\n", 0xB3);
	else
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write success----\n", 0xB3);

	/* set AVEE */
	/*ret = RT5081_write_byte(0xB4, (1 << 6) | 28);*/
	ret = PMU_REG_MASK(0xB4, 28, (0x3F << 0));
	if (ret < 0)
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write error----\n", 0xB4);
	else
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write success----\n", 0xB4);

	/* enable AVDD & AVEE */
	/* 0x12--default value; bit3--Vneg; bit6--Vpos; */
	/*ret = RT5081_write_byte(0xB1, 0x12 | (1<<3) | (1<<6));*/
	ret = PMU_REG_MASK(0xB1, (1<<3) | (1<<6), (1<<3) | (1<<6));
	if (ret < 0)
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write error----\n", 0xB1);
	else
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write success----\n", 0xB1);

	MDELAY(10);

#endif
	mt_set_gpio_mode(GPIO_TP_RST, GPIO_MODE_00);
	mt_set_gpio_dir(GPIO_TP_RST, GPIO_DIR_OUT);
	mt_set_gpio_out(GPIO_TP_RST, GPIO_OUT_ONE);

	SET_RESET_PIN(1);
	MDELAY(10);
	SET_RESET_PIN(0);
	MDELAY(20);

	SET_RESET_PIN(1);
	MDELAY(120);//250
	
	push_table(lcm_initialization_setting,sizeof(lcm_initialization_setting) / sizeof(struct LCM_setting_table), 1);
}

static void lcm_suspend(void)
{
	int ret = 0;

	push_table(lcm_suspend_setting,sizeof(lcm_suspend_setting) / sizeof(struct LCM_setting_table), 1);     
	
#ifndef MACH_FPGA
	/* enable AVDD & AVEE */
	/* 0x12--default value; bit3--Vneg; bit6--Vpos; */
	/*ret = RT5081_write_byte(0xB1, 0x12);*/
	ret = PMU_REG_MASK(0xB1, (0<<3) | (0<<6), (1<<3) | (1<<6));
	if (ret < 0)
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write error----\n", 0xB1);
	else
		LCM_LOGI("nt35695----tps6132----cmd=%0x--i2c write success----\n", 0xB1);

	MDELAY(5);

#endif
}

static void lcm_resume(void)
{
	lcm_init();
}


LCM_DRIVER td4321_fhdp_dsi_vdo_auo_drv = 
{
    .name			= "td4321_fhdp_dsi_vdo_auo",
	.set_util_funcs = lcm_set_util_funcs,
	.get_params     = lcm_get_params,
	.init           = lcm_init,
	.suspend        = lcm_suspend,
	.resume         = lcm_resume,
	.compare_id     = lcm_compare_id,

};
